<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Rezervasyon FC</title>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"
    />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      
      body {
        font-family: 'Roboto', sans-serif;
        background: #f5f5f5;
        min-height: 100vh;
      }

      .container {
        max-width: 1600px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 30px;
        padding: 20px;
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .header h1 {
        color: #2E7D32;
        font-size: 24px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .header i {
        color: #4CAF50;
      }

      .profile-section {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .profile-info {
        text-align: right;
      }

      .profile-name {
        font-weight: 500;
        color: #333;
      }

      .profile-email {
        font-size: 14px;
        color: #666;
      }

      .logout-button {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        background: #f44336;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 14px;
        transition: all 0.3s ease;
      }

      .logout-button:hover {
        background: #d32f2f;
        transform: translateX(3px);
      }

      .back-button {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        background: #4CAF50;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        text-decoration: none;
        font-size: 14px;
        transition: all 0.3s ease;
      }

      .back-button:hover {
        background: #388E3C;
        transform: translateX(-3px);
      }

      .main-content {
        display: grid;
        grid-template-columns: 200px 1fr;
        gap: 20px;
      }

      .menu {
        background: white;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        height: fit-content;
      }

      .menu-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 12px;
        color: #666;
        text-decoration: none;
        border-radius: 8px;
        transition: all 0.3s ease;
        margin-bottom: 5px;
      }

      .menu-item:hover {
        background: #f5f5f5;
        color: #2E7D32;
      }

      .menu-item.active {
        background: #e8f5e9;
        color: #2E7D32;
      }

      .menu-item .badge {
        background: #f44336;
        color: white;
        padding: 2px 8px;
        border-radius: 12px;
        font-size: 12px;
        margin-left: auto;
      }

      .menu-item .badge.pending {
        background: #f57c00;
      }

      .menu-item .badge.receipt {
        background: #2196F3;
      }

      .content {
        background: white;
        border-radius: 10px;
        padding: 30px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .section {
        display: none;
      }

      .section.active {
        display: block;
      }

      .section-title {
        color: #2E7D32;
        font-size: 24px;
        margin-bottom: 30px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        color: #333;
        font-weight: 500;
      }

      .form-group input,
      .form-group textarea,
      .form-group select {
        width: 100%;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 14px;
        transition: all 0.3s ease;
        background: #f9f9f9;
      }

      .form-group input:focus,
      .form-group textarea:focus,
      .form-group select:focus {
        border-color: #4CAF50;
        outline: none;
        box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        background: white;
      }

      .form-group textarea {
        min-height: 100px;
        resize: vertical;
      }

      .form-actions {
        margin-top: 30px;
        display: flex;
        justify-content: flex-end;
        gap: 15px;
      }

      .form-actions .button {
        min-width: 150px;
      }

      .field-list {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 15px;
        padding: 10px;
      }

      .field-card {
        background: white;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        height: 100%;
        display: flex;
        flex-direction: column;
      }

      .field-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
      }

      .field-image {
        width: 100%;
        height: 200px;
        object-fit: cover;
      }

      .field-content {
        padding: 15px;
        flex: 1;
        display: flex;
        flex-direction: column;
      }

      .field-title {
        font-size: 18px;
        margin-bottom: 10px;
      }

      .field-info {
        font-size: 14px;
        margin: 8px 0;
      }

      .field-actions {
        margin-top: auto;
        display: flex;
        gap: 10px;
      }

      .button {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        padding: 12px 24px;
        background: #4CAF50;
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .button:hover {
        background: #388E3C;
        transform: translateY(-2px);
      }

      .button.edit {
        background: #2196F3;
      }

      .button.edit:hover {
        background: #1976D2;
      }

      .button.delete {
        background: #f44336;
      }

      .button.delete:hover {
        background: #d32f2f;
      }

      .reservations-list {
        margin-top: 20px;
        border-top: 1px solid #e0e0e0;
        padding-top: 20px;
      }

      .reservation-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px;
        background: #f5f5f5;
        border-radius: 8px;
        margin-bottom: 10px;
      }

      .reservation-info {
        display: flex;
        flex-direction: column;
        gap: 5px;
      }

      .reservation-date {
        font-weight: 500;
        color: #333;
      }

      .reservation-time {
        color: #666;
        font-size: 14px;
      }

      .reservation-status {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 500;
      }

      .status-pending {
        background: #fff3e0;
        color: #f57c00;
      }

      .status-confirmed {
        background: #e8f5e9;
        color: #2E7D32;
      }

      .status-cancelled {
        background: #ffebee;
        color: #f44336;
      }

      .no-reservations {
        text-align: center;
        color: #666;
        padding: 20px;
        background: #f5f5f5;
        border-radius: 8px;
      }

      .form-group input[type="file"] {
        padding: 8px;
        background: white;
      }

      .image-preview {
        width: 100%;
        max-height: 200px;
        object-fit: cover;
        border-radius: 8px;
        margin-top: 10px;
        display: none;
      }

      .image-preview.show {
        display: block;
      }

      .edit-form {
        display: none;
      }

      .edit-form.active {
        display: block;
      }

      .field-card {
        position: relative;
      }

      .field-card.editing {
        background: #f9f9f9;
      }

      .field-card.editing .field-content {
        opacity: 0.5;
      }

      .field-card.editing .edit-form {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        background: white;
        padding: 20px;
        border-radius: 10px;
        z-index: 1;
      }

      .features-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-top: 10px;
      }

      .feature-checkbox {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 10px;
        background: #f5f5f5;
        border-radius: 8px;
        transition: all 0.3s ease;
      }

      .feature-checkbox:hover {
        background: #e8f5e9;
      }

      .feature-checkbox input[type="checkbox"] {
        width: 18px;
        height: 18px;
        cursor: pointer;
      }

      .feature-checkbox label {
        font-size: 14px;
        color: #333;
        cursor: pointer;
      }

      @media (max-width: 1400px) {
        .field-list {
          grid-template-columns: repeat(3, 1fr);
        }
      }

      @media (max-width: 1200px) {
        .field-list {
          grid-template-columns: repeat(2, 1fr);
        }
      }

      @media (max-width: 768px) {
        .main-content {
          grid-template-columns: 1fr;
        }

        .header {
          flex-direction: column;
          gap: 15px;
          text-align: center;
        }
        
        .profile-section {
          flex-direction: column;
          text-align: center;
        }

        .field-list {
          grid-template-columns: 1fr;
        }
      }

      .time-range {
        display: flex;
        gap: 20px;
        margin-top: 10px;
      }

      .time-input {
        flex: 1;
      }

      .time-input label {
        display: block;
        margin-bottom: 5px;
        color: #666;
        font-size: 14px;
      }

      .time-input input[type="time"] {
        width: 100%;
        padding: 12px;
        border: 1px solid #ddd;
        border-radius: 6px;
        font-size: 15px;
        transition: all 0.3s ease;
      }

      .time-input input[type="time"]:focus {
        border-color: #4CAF50;
        box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
        outline: none;
      }

      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        justify-content: center;
        align-items: center;
      }

      .modal-content {
        background: white;
        padding: 30px;
        border-radius: 10px;
        width: 90%;
        max-width: 600px;
        max-height: 90vh;
        overflow-y: auto;
        position: relative;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      }

      .modal-close {
        position: absolute;
        top: 15px;
        right: 15px;
        background: none;
        border: none;
        font-size: 20px;
        color: #666;
        cursor: pointer;
        padding: 5px;
        transition: all 0.3s ease;
      }

      .modal-close:hover {
        color: #f44336;
        transform: rotate(90deg);
      }

      .modal-title {
        color: #2E7D32;
        font-size: 24px;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .modal-form {
        display: flex;
        flex-direction: column;
        gap: 15px;
      }

      .modal-input {
        width: 100%;
        padding: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        font-size: 14px;
        transition: all 0.3s ease;
        background: #f9f9f9;
      }

      .modal-input:focus {
        border-color: #4CAF50;
        outline: none;
        box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        background: white;
      }

      .reservation-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        transition: all 0.3s ease;
      }

      .reservation-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
      }

      .reservation-header {
        background: #4CAF50;
        color: white;
        padding: 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .reservation-field {
        font-size: 18px;
        font-weight: 500;
      }

      .reservation-status {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 500;
        background: rgba(255, 255, 255, 0.2);
      }

      .reservation-content {
        padding: 20px;
      }

      .reservation-info {
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .reservation-detail {
        display: flex;
        align-items: center;
        gap: 10px;
        color: #666;
      }

      .reservation-detail i {
        width: 20px;
        color: #4CAF50;
      }

      .receipt-preview-container {
        width: 100%;
        display: flex;
        justify-content: center;
        margin: 15px 0;
        background: #f5f5f5;
        padding: 10px;
        border-radius: 8px;
      }

      .receipt-preview {
        max-width: 100%;
        height: auto;
        border-radius: 4px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }

      .receipt-section {
        margin-top: 20px;
        padding: 15px;
        background: #f9f9f9;
        border-radius: 8px;
        border: 1px solid #eee;
      }

      .receipt-status {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        color: #666;
        margin-bottom: 15px;
      }

      .receipt-actions {
        display: flex;
        gap: 10px;
        margin-top: 15px;
      }

      .button.verify {
        background: #e8f5e9;
        color: #2E7D32;
      }

      .button.verify:hover {
        background: #2E7D32;
        color: white;
      }

      .button.reject {
        background: #ffebee;
        color: #f44336;
      }

      .button.reject:hover {
        background: #f44336;
        color: white;
      }

      .notification {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 15px 30px;
        border-radius: 8px;
        font-size: 16px;
        z-index: 9999;
        display: flex;
        align-items: center;
        gap: 10px;
        opacity: 0;
        transition: opacity 0.3s ease;
        pointer-events: none;
      }

      .notification.show {
        opacity: 1;
      }

      .notification i {
        font-size: 20px;
      }

      .notification.success {
        background: rgba(46, 125, 50, 0.9);
      }

      .notification.error {
        background: rgba(244, 67, 54, 0.9);
      }

      .notification.info {
        background: rgba(33, 150, 243, 0.9);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1><i class="fas fa-user-shield"></i> Saha Sahibi Paneli</h1>
        <div class="profile-section">
          <div class="profile-info">
            <div class="profile-name" id="profileName"></div>
            <div class="profile-email" id="profileEmail"></div>
          </div>
          <button class="logout-button" onclick="handleLogout()">
            <i class="fas fa-sign-out-alt"></i>
            Çıkış Yap
          </button>
        </div>
      </div>
      
      <div class="main-content">
        <div class="menu">
          <a href="#" class="menu-item active" onclick="showSection('profile')">
            <i class="fas fa-user"></i>
            Profil
          </a>
          <a href="#" class="menu-item" onclick="showSection('fields')">
            <i class="fas fa-futbol"></i>
            Sahalarım
          </a>
          <a href="#" class="menu-item" onclick="showSection('addField')">
            <i class="fas fa-plus"></i>
            Saha Ekle
          </a>
          <a href="#" class="menu-item" onclick="showSection('pendingReservations')">
            <i class="fas fa-clock"></i>
            Rezervasyon Talepleri
            <span class="badge pending" id="pendingReservationsCount">0</span>
          </a>
          <a href="#" class="menu-item" onclick="showSection('pendingReceipts')">
            <i class="fas fa-file-invoice"></i>
            Dekont Onayı Bekleyenler
            <span class="badge receipt" id="pendingReceiptsCount">0</span>
          </a>
        </div>

        <div class="content">
          <div id="profile" class="section active">
            <h2 class="section-title">
              <i class="fas fa-user"></i>
              Profil Bilgileri
            </h2>
            <form id="profileForm" onsubmit="return updateProfile(event)">
              <div class="form-group">
                <label for="name">Ad Soyad</label>
                <input type="text" id="name" required placeholder="Adınız ve soyadınız">
              </div>
              <div class="form-group">
                <label for="email">E-posta</label>
                <input type="email" id="email" required placeholder="ornek@email.com">
              </div>
              <div class="form-group">
                <label for="phone">Telefon</label>
                <input type="tel" id="phone" required placeholder="05XX XXX XX XX">
              </div>
              <div class="form-group">
                <label for="iban">IBAN</label>
                <input type="text" id="iban" required placeholder="TRXX XXXX XXXX XXXX XXXX XXXX XX">
              </div>
              <div class="form-group">
                <label for="password">Yeni Şifre (Opsiyonel)</label>
                <input type="password" id="password" placeholder="En az 6 karakter">
              </div>
              <div class="form-actions">
                <button type="submit" class="button">
                  <i class="fas fa-save"></i>
                  Kaydet
                </button>
              </div>
            </form>
          </div>

          <div id="fields" class="section">
            <h2 class="section-title">
              <i class="fas fa-futbol"></i>
              Sahalarım
            </h2>
            <div class="field-list" id="fieldList">
              <!-- Sahalar JavaScript ile eklenecek -->
            </div>
          </div>

          <div id="addField" class="section">
            <h2 class="section-title">
              <i class="fas fa-plus"></i>
              Yeni Saha Ekle
            </h2>
            <form id="addFieldForm" onsubmit="return addField(event)">
              <div class="form-group">
                <label for="fieldName">Saha Adı</label>
                <input type="text" id="fieldName" required placeholder="Örn: Yeşil Saha">
              </div>
              <div class="form-group">
                <label for="fieldCity">Şehir</label>
                <input type="text" id="fieldCity" required placeholder="Örn: İstanbul">
              </div>
              <div class="form-group">
                <label class="form-label">Saha Konumu</label>
                <input type="text" class="modal-input" id="fieldLocation" required placeholder="Örn: Kadıköy">
                <input type="text" class="modal-input" id="fieldDetailedLocation" placeholder="Detaylı konum (örn: Mahalle, Sokak, No)" required>
              </div>
              <div class="form-group">
                <label for="fieldPrice">Saatlik Ücret (TL)</label>
                <input type="number" id="fieldPrice" required min="0" placeholder="Örn: 200">
              </div>
              <div class="form-group">
                <label class="form-label">Çalışma Saatleri</label>
                <div class="time-range">
                  <div class="time-input">
                    <label>Açılış Saati</label>
                    <input type="time" id="fieldOpenTime" class="modal-input" required>
                  </div>
                  <div class="time-input">
                    <label>Kapanış Saati</label>
                    <input type="time" id="fieldCloseTime" class="modal-input" required>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label>Saha Özellikleri</label>
                <div class="features-grid">
                  <div class="feature-checkbox">
                    <input type="checkbox" id="fieldParking" name="features" value="parking">
                    <label for="fieldParking">Otopark</label>
                  </div>
                  <div class="feature-checkbox">
                    <input type="checkbox" id="fieldLockerRoom" name="features" value="lockerRoom">
                    <label for="fieldLockerRoom">Soyunma Odası</label>
                  </div>
                  <div class="feature-checkbox">
                    <input type="checkbox" id="fieldCleatsRental" name="features" value="cleatsRental">
                    <label for="fieldCleatsRental">Krampon Kiralama</label>
                  </div>
                  <div class="feature-checkbox">
                    <input type="checkbox" id="fieldShower" name="features" value="shower">
                    <label for="fieldShower">Duş</label>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label for="fieldImage">Saha Görseli</label>
                <input type="file" id="fieldImage" accept="image/*" required onchange="previewImage(this)">
                <img id="imagePreview" class="image-preview">
              </div>
              <div class="form-actions">
                <button type="submit" class="button">
                  <i class="fas fa-plus"></i>
                  Saha Ekle
                </button>
              </div>
            </form>
          </div>

          <div id="pendingReservations" class="section">
            <h2 class="section-title">
              <i class="fas fa-clock"></i>
              Rezervasyon Talepleri
            </h2>
            <div class="reservations-list" id="reservationsList">
              <!-- Rezervasyonlar JavaScript ile eklenecek -->
        </div>
          </div>

          <div id="pendingReceipts" class="section">
            <h2 class="section-title">
              <i class="fas fa-file-invoice"></i>
              Dekont Onayı Bekleyenler
            </h2>
            <div class="reservations-list" id="pendingReceiptsList">
              <!-- Dekont onayı bekleyen rezervasyonlar JavaScript ile eklenecek -->
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Saha Düzenleme Modal -->
    <div id="editFieldModal" class="modal">
      <div class="modal-content">
        <button class="modal-close" onclick="closeEditFieldModal()">
          <i class="fas fa-times"></i>
        </button>
        <h2 class="modal-title">
          <i class="fas fa-edit"></i>
          Saha Düzenle
        </h2>
        <form id="editFieldForm" class="modal-form" onsubmit="saveEdit(event)">
          <input type="hidden" id="editFieldId">
          <div class="form-group">
            <label for="editFieldName">Saha Adı</label>
            <input type="text" id="editFieldName" required placeholder="Örn: Yeşil Saha">
          </div>
          <div class="form-group">
            <label for="editFieldCity">Şehir</label>
            <input type="text" id="editFieldCity" required placeholder="Örn: İstanbul">
          </div>
          <div class="form-group">
            <label class="form-label">Saha Konumu</label>
            <input type="text" class="modal-input" id="editFieldLocation" required placeholder="Örn: Kadıköy">
            <input type="text" class="modal-input" id="editFieldDetailedLocation" placeholder="Detaylı konum (örn: Mahalle, Sokak, No)" required>
          </div>
          <div class="form-group">
            <label for="editFieldPrice">Saatlik Ücret (TL)</label>
            <input type="number" id="editFieldPrice" required min="0" placeholder="Örn: 200">
          </div>
          <div class="form-group">
            <label class="form-label">Çalışma Saatleri</label>
            <div class="time-range">
              <div class="time-input">
                <label>Açılış Saati</label>
                <input type="time" id="editFieldOpenTime" class="modal-input" required>
              </div>
              <div class="time-input">
                <label>Kapanış Saati</label>
                <input type="time" id="editFieldCloseTime" class="modal-input" required>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label>Saha Özellikleri</label>
            <div class="features-grid">
              <div class="feature-checkbox">
                <input type="checkbox" id="editFieldParking" name="features" value="parking">
                <label for="editFieldParking">Otopark</label>
              </div>
              <div class="feature-checkbox">
                <input type="checkbox" id="editFieldLockerRoom" name="features" value="lockerRoom">
                <label for="editFieldLockerRoom">Soyunma Odası</label>
              </div>
              <div class="feature-checkbox">
                <input type="checkbox" id="editFieldCleatsRental" name="features" value="cleatsRental">
                <label for="editFieldCleatsRental">Krampon Kiralama</label>
              </div>
              <div class="feature-checkbox">
                <input type="checkbox" id="editFieldShower" name="features" value="shower">
                <label for="editFieldShower">Duş</label>
              </div>
            </div>
          </div>
          <div class="form-group">
            <label for="editFieldImage">Saha Görseli</label>
            <input type="file" id="editFieldImage" accept="image/*" onchange="previewEditImage(this)">
            <img id="editImagePreview" class="image-preview">
          </div>
          <div class="form-actions">
            <button type="submit" class="button">
              <i class="fas fa-save"></i>
              Kaydet
            </button>
          </div>
        </form>
      </div>
    </div>

    <script>
      // Kullanıcı kontrolü
      const currentUser = JSON.parse(localStorage.getItem('currentUser'));
      if (!currentUser || currentUser.type !== 'admin') {
        window.location.href = 'index.html';
      }

      // Profil bilgilerini yükle
      document.getElementById('profileName').textContent = currentUser.name;
      document.getElementById('profileEmail').textContent = currentUser.email;
      document.getElementById('name').value = currentUser.name;
      document.getElementById('email').value = currentUser.email;
      document.getElementById('phone').value = currentUser.phone || '';
      document.getElementById('iban').value = currentUser.iban || '';

      // Bölüm gösterme
      function showSection(sectionId) {
        document.querySelectorAll('.section').forEach(section => {
          section.classList.remove('active');
        });
        document.querySelectorAll('.menu-item').forEach(item => {
          item.classList.remove('active');
        });
        document.getElementById(sectionId).classList.add('active');
        document.querySelector(`[onclick="showSection('${sectionId}')"]`).classList.add('active');
        
        if (sectionId === 'pendingReservations') {
          loadReservations();
        } else if (sectionId === 'pendingReceipts') {
          loadPendingReceipts();
        }
      }

      // Profil güncelleme
      function updateProfile(event) {
        event.preventDefault();
        
        const name = document.getElementById('name').value;
        const email = document.getElementById('email').value;
        const phone = document.getElementById('phone').value;
        const iban = document.getElementById('iban').value;
        const password = document.getElementById('password').value;
        
        // Kullanıcıları al
        const users = JSON.parse(localStorage.getItem('users')) || { player: [], admin: [] };
        const userIndex = users.admin.findIndex(u => u.id === currentUser.id);
        
        if (userIndex === -1) return false;
        
        // E-posta kontrolü
        const emailExists = users.admin.some(user => 
          user.email === email && user.id !== currentUser.id
        );

        if (emailExists) {
          showNotification('error', 'Hata', 'Bu e-posta adresi başka bir kullanıcı tarafından kullanılıyor.');
          return false;
        }
        
        // Profil bilgilerini güncelle
        users.admin[userIndex] = {
          ...users.admin[userIndex],
          name,
          email,
          phone,
          iban,
          ...(password && { password })
        };
        
        localStorage.setItem('users', JSON.stringify(users));
        localStorage.setItem('currentUser', JSON.stringify(users.admin[userIndex]));
        
        // Profil bilgilerini güncelle
        document.getElementById('profileName').textContent = name;
        document.getElementById('profileEmail').textContent = email;
        
        showNotification('Başarılı', 'Profil bilgileriniz güncellendi!', 'success');
        return false;
      }

      function addField(event) {
        event.preventDefault();
        
        const name = document.getElementById('fieldName').value;
        const city = document.getElementById('fieldCity').value;
        const location = document.getElementById('fieldLocation').value;
        const detailedLocation = document.getElementById('fieldDetailedLocation').value;
        const price = document.getElementById('fieldPrice').value;
        const openTime = document.getElementById('fieldOpenTime').value;
        const closeTime = document.getElementById('fieldCloseTime').value;
        const imageFile = document.getElementById('fieldImage').files[0];
        
        if (!imageFile) {
          showNotification('Hata', 'Lütfen bir saha fotoğrafı seçin', 'error');
          return;
        }

        // Fotoğraf boyutunu kontrol et (max 5MB)
        if (imageFile.size > 5 * 1024 * 1024) {
          showNotification('Hata', 'Fotoğraf boyutu 5MB\'dan küçük olmalıdır', 'error');
          return;
        }

        // Fotoğraf tipini kontrol et
        if (!imageFile.type.startsWith('image/')) {
          showNotification('Hata', 'Lütfen geçerli bir fotoğraf dosyası seçin', 'error');
          return;
        }
        
        const reader = new FileReader();
        reader.onload = function(e) {
          const field = {
            id: Date.now().toString(),
            adminId: currentUser.id,
            name,
            city,
            location,
            detailedLocation,
            price,
            openTime,
            closeTime,
            image: e.target.result, // Base64 formatında fotoğraf
            features: {
              parking: document.getElementById('fieldParking').checked,
              lockerRoom: document.getElementById('fieldLockerRoom').checked,
              cleatsRental: document.getElementById('fieldCleatsRental').checked,
              shower: document.getElementById('editFieldShower').checked
            },
            phone: currentUser.phone
          };
          
          const fields = JSON.parse(localStorage.getItem('fields')) || [];
          fields.push(field);
          localStorage.setItem('fields', JSON.stringify(fields));
          
          document.getElementById('addFieldForm').reset();
          document.getElementById('imagePreview').classList.remove('show');
          showNotification('Başarılı', 'Saha başarıyla eklendi', 'success');
          loadFields();
        };
        
        reader.readAsDataURL(imageFile);
      }

      // Görsel önizleme
      function previewImage(input) {
        const preview = document.getElementById('imagePreview');
        if (input.files && input.files[0]) {
          const reader = new FileReader();
          reader.onload = function(e) {
            preview.src = e.target.result;
            preview.classList.add('show');
          };
          reader.readAsDataURL(input.files[0]);
        }
      }

      // Sahaları yükle
      function loadFields() {
        const fields = JSON.parse(localStorage.getItem('fields')) || [];
        const reservations = JSON.parse(localStorage.getItem('reservations')) || [];
        const fieldList = document.getElementById('fieldList');
        
        // Admin'in sahalarını filtrele
        const adminFields = fields.filter(field => field.adminId === currentUser.id);
        
        if (adminFields.length === 0) {
          fieldList.innerHTML = `
            <div class="no-reservations">
              <i class="fas fa-info-circle"></i>
              <p>Henüz hiç saha eklemediniz.</p>
            </div>
          `;
          return;
        }
        
        fieldList.innerHTML = '';
        
        adminFields.forEach(field => {
          // Sahaya ait rezervasyonları filtrele
          const fieldReservations = reservations.filter(r => r.fieldId === field.id);
          
          const card = document.createElement('div');
          card.className = 'field-card';
          card.setAttribute('data-field-id', field.id);
          card.innerHTML = `
            <img src="${field.image}" alt="${field.name}" class="field-image">
            <div class="field-content">
              <h3 class="field-title">
                <i class="fas fa-futbol"></i>
                ${field.name}
              </h3>
              <p class="field-info">
                <i class="fas fa-map-marker-alt"></i>
                ${field.city}
              </p>
              <p class="field-info">
                <i class="fas fa-location-dot"></i>
                ${field.location}
              </p>
              <p class="field-info">
                <i class="fas fa-tag"></i>
                ${field.price} TL/saat
              </p>
              <div class="field-actions">
                <button class="button edit" onclick="editField('${field.id}')">
                  <i class="fas fa-edit"></i>
                  Düzenle
                </button>
                <button class="button delete" onclick="deleteField('${field.id}')">
                  <i class="fas fa-trash"></i>
                  Sil
                </button>
              </div>
              <div class="reservations-list">
                <h4>Rezervasyonlar</h4>
                ${fieldReservations.length > 0 ? 
                  fieldReservations.map(r => `
                    <div class="reservation-item">
                      <div class="reservation-info">
                        <div class="reservation-date">${r.date}</div>
                        <div class="reservation-time">${r.time}</div>
                        <div class="reservation-player">${r.playerName}</div>
                      </div>
                      <div class="reservation-actions">
                        ${r.status === 'pending' ? `
                          <button class="button" onclick="approveReservation('${r.id}')">
                            <i class="fas fa-check"></i>
                            Onayla
                          </button>
                          <button class="button delete" onclick="rejectReservation('${r.id}')">
                            <i class="fas fa-times"></i>
                            Reddet
                          </button>
                        ` : `
                          <div class="reservation-status status-${r.status}">
                            ${r.status === 'confirmed' ? 'Onaylandı' : 'İptal Edildi'}
                          </div>
                        `}
                      </div>
                    </div>
                  `).join('') :
                  `<div class="no-reservations">
                    <i class="fas fa-info-circle"></i>
                    <p>Henüz rezervasyon yok.</p>
                  </div>`
                }
              </div>
            </div>
          `;
          fieldList.appendChild(card);
        });
      }

      // Saha düzenleme
      function editField(fieldId) {
        const fields = JSON.parse(localStorage.getItem('fields')) || [];
        const field = fields.find(f => f.id === fieldId);
        
        if (field) {
          document.getElementById('editFieldId').value = field.id;
          document.getElementById('editFieldName').value = field.name;
          document.getElementById('editFieldLocation').value = field.location;
          document.getElementById('editFieldDetailedLocation').value = field.detailedLocation || '';
          document.getElementById('editFieldCity').value = field.city;
          document.getElementById('editFieldPrice').value = field.price;
          document.getElementById('editFieldOpenTime').value = field.openTime;
          document.getElementById('editFieldCloseTime').value = field.closeTime;
          
          // Özellikleri işaretle
          document.getElementById('editFieldParking').checked = field.features?.parking || false;
          document.getElementById('editFieldLockerRoom').checked = field.features?.lockerRoom || false;
          document.getElementById('editFieldCleatsRental').checked = field.features?.cleatsRental || false;
          document.getElementById('editFieldShower').checked = field.features?.shower || false;
          
          // Görsel önizleme
          const imagePreview = document.getElementById('editImagePreview');
          if (field.image) {
            imagePreview.src = field.image;
            imagePreview.classList.add('show');
          } else {
            imagePreview.classList.remove('show');
          }
          
          document.getElementById('editFieldModal').style.display = 'flex';
        }
      }

      function closeEditFieldModal() {
        document.getElementById('editFieldModal').style.display = 'none';
        document.getElementById('editFieldForm').reset();
        document.getElementById('editImagePreview').classList.remove('show');
      }

      function previewEditImage(input) {
        const preview = document.getElementById('editImagePreview');
        if (input.files && input.files[0]) {
          const reader = new FileReader();
          reader.onload = function(e) {
            preview.src = e.target.result;
            preview.classList.add('show');
          };
          reader.readAsDataURL(input.files[0]);
        }
      }

      function saveEdit(event) {
        event.preventDefault();
        
        const fieldId = document.getElementById('editFieldId').value;
        const fields = JSON.parse(localStorage.getItem('fields')) || [];
        const fieldIndex = fields.findIndex(f => f.id === fieldId);
        
        if (fieldIndex !== -1) {
          const imageFile = document.getElementById('editFieldImage').files[0];
          let imageUrl = fields[fieldIndex].image;
          
          if (imageFile) {
            // Fotoğraf boyutunu kontrol et (max 5MB)
            if (imageFile.size > 5 * 1024 * 1024) {
              showNotification('Hata', 'Fotoğraf boyutu 5MB\'dan küçük olmalıdır', 'error');
              return;
            }

            // Fotoğraf tipini kontrol et
            if (!imageFile.type.startsWith('image/')) {
              showNotification('Hata', 'Lütfen geçerli bir fotoğraf dosyası seçin', 'error');
              return;
            }

          const reader = new FileReader();
          reader.onload = function(e) {
              updateField(fieldIndex, fields, e.target.result);
          };
          reader.readAsDataURL(imageFile);
        } else {
            updateField(fieldIndex, fields, imageUrl);
          }
        }
      }

      function updateField(fieldIndex, fields, imageUrl) {
        fields[fieldIndex] = {
          ...fields[fieldIndex],
          name: document.getElementById('editFieldName').value,
          location: document.getElementById('editFieldLocation').value,
          detailedLocation: document.getElementById('editFieldDetailedLocation').value,
          city: document.getElementById('editFieldCity').value,
          price: document.getElementById('editFieldPrice').value,
          openTime: document.getElementById('editFieldOpenTime').value,
          closeTime: document.getElementById('editFieldCloseTime').value,
          image: imageUrl,
          features: {
            parking: document.getElementById('editFieldParking').checked,
            lockerRoom: document.getElementById('editFieldLockerRoom').checked,
            cleatsRental: document.getElementById('editFieldCleatsRental').checked,
            shower: document.getElementById('editFieldShower').checked
          }
        };
        
        localStorage.setItem('fields', JSON.stringify(fields));
        closeEditFieldModal();
        showNotification('Başarılı', 'Saha bilgileri güncellendi', 'success');
        loadFields();
      }

      // Saha silme
      function deleteField(fieldId) {
        if (confirm('Bu sahayı silmek istediğinizden emin misiniz?')) {
          const fields = JSON.parse(localStorage.getItem('fields')) || [];
          const updatedFields = fields.filter(f => f.id !== fieldId);
          localStorage.setItem('fields', JSON.stringify(updatedFields));
          
          showNotification('Başarılı', 'Saha başarıyla silindi!', 'success');
          loadFields();
        }
      }

      // Çıkış yapma
      function handleLogout() {
        localStorage.removeItem('currentUser');
        window.location.href = 'index.html';
      }

      // Bildirim gösterme fonksiyonu
      function showNotification(title, message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `notification ${type}`;
        notification.innerHTML = `
          <i class="fas ${type === 'success' ? 'fa-check-circle' : 
                         type === 'error' ? 'fa-exclamation-circle' : 
                         'fa-info-circle'}"></i>
          <div class="notification-content">
            <div class="notification-title">${title}</div>
            <div class="notification-message">${message}</div>
          </div>
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
          notification.remove();
        }, 3000);
      }

      // Rezervasyon onaylama
      function approveReservation(reservationId) {
        const reservations = JSON.parse(localStorage.getItem('reservations')) || [];
        const reservationIndex = reservations.findIndex(r => r.id === reservationId);
        
        if (reservationIndex === -1) return;
        
        // Rezervasyonu güncelle
        reservations[reservationIndex] = {
          ...reservations[reservationIndex],
          status: 'confirmed'
        };
        
        localStorage.setItem('reservations', JSON.stringify(reservations));
        
        // Oyuncuya bildirim gönder
        const notification = {
          id: Date.now().toString(),
          userId: reservations[reservationIndex].playerId,
          type: 'reservation_approved',
          message: `Rezervasyonunuz onaylandı. Ödeme için IBAN: ${currentUser.iban}`,
          date: new Date().toISOString(),
          read: false
        };
        
        const notifications = JSON.parse(localStorage.getItem('notifications')) || [];
        notifications.push(notification);
        localStorage.setItem('notifications', JSON.stringify(notifications));
        
        showNotification('Başarılı', 'Rezervasyon onaylandı!', 'success');
        loadFields();
      }

      // Rezervasyon reddetme
      function rejectReservation(reservationId) {
        const reservations = JSON.parse(localStorage.getItem('reservations')) || [];
        const reservationIndex = reservations.findIndex(r => r.id === reservationId);
        
        if (reservationIndex === -1) return;
        
        // Rezervasyonu güncelle
        reservations[reservationIndex] = {
          ...reservations[reservationIndex],
          status: 'cancelled'
        };
        
        localStorage.setItem('reservations', JSON.stringify(reservations));
        
        // Oyuncuya bildirim gönder
        const notification = {
          id: Date.now().toString(),
          userId: reservations[reservationIndex].playerId,
          type: 'reservation_rejected',
          message: 'Rezervasyonunuz reddedildi.',
          date: new Date().toISOString(),
          read: false
        };
        
        const notifications = JSON.parse(localStorage.getItem('notifications')) || [];
        notifications.push(notification);
        localStorage.setItem('notifications', JSON.stringify(notifications));
        
        showNotification('Başarılı', 'Rezervasyon reddedildi!', 'success');
        loadFields();
      }

      // Rezervasyonları yükle
      function loadReservations() {
        const reservations = JSON.parse(localStorage.getItem('reservations')) || [];
        const fields = JSON.parse(localStorage.getItem('fields')) || [];
        const users = JSON.parse(localStorage.getItem('users')) || { player: [] };
        
        // Sadece bu saha sahibinin sahalarına ait rezervasyonları filtrele
        const adminFields = fields.filter(f => f.adminId === currentUser.id);
        const adminFieldIds = adminFields.map(f => f.id);
        const adminReservations = reservations.filter(r => adminFieldIds.includes(r.fieldId));
        
        // Bekleyen rezervasyon sayısını güncelle
        const pendingReservations = adminReservations.filter(r => r.status === 'pending');
        document.getElementById('pendingReservationsCount').textContent = pendingReservations.length;
        
        // Dekont onayı bekleyen rezervasyon sayısını güncelle
        const pendingReceipts = adminReservations.filter(r => 
          r.status === 'confirmed' && 
          r.receipt && 
          (!r.receiptStatus || r.receiptStatus === 'rejected')
        );
        document.getElementById('pendingReceiptsCount').textContent = pendingReceipts.length;
        
        const reservationsList = document.getElementById('reservationsList');
        
        if (adminReservations.length === 0) {
          reservationsList.innerHTML = `
            <div class="no-reservations">
              <i class="fas fa-calendar-check"></i>
              <p>Henüz hiç rezervasyon bulunmuyor.</p>
            </div>
          `;
          return;
        }
        
        reservationsList.innerHTML = '';
        
        // Sadece bekleyen rezervasyonları göster
        const pendingReservationsList = adminReservations.filter(r => r.status === 'pending');
        
        pendingReservationsList.forEach(reservation => {
          const field = fields.find(f => f.id === reservation.fieldId);
          const player = users.player.find(p => p.id === reservation.playerId);
          
          if (!field || !player) return;
          
          const card = document.createElement('div');
          card.className = 'reservation-card';
          card.innerHTML = `
            <div class="reservation-header">
              <div class="reservation-field">
                <i class="fas fa-futbol"></i>
                ${field.name}
              </div>
              <div class="reservation-status status-pending">
                Onay Bekliyor
              </div>
            </div>
            <div class="reservation-content">
              <div class="reservation-info">
                <div class="reservation-detail">
                  <i class="fas fa-user"></i>
                  <div>
                    <div>${player.name}</div>
                    <div style="font-size: 12px; color: #999;">${player.email}</div>
                  </div>
                </div>
                <div class="reservation-detail">
                  <i class="fas fa-calendar"></i>
                  <div>
                    <div class="reservation-date">${reservation.date}</div>
                    <div class="reservation-time">${reservation.time}</div>
                  </div>
                </div>
                <div class="reservation-detail">
                  <i class="fas fa-phone"></i>
                  <div class="reservation-phone">${player.phone}</div>
                </div>
                <div class="reservation-price">
                  ${field.price} TL
                </div>
              </div>
              <div class="reservation-actions">
                <button class="button confirm" onclick="confirmReservation('${reservation.id}')">
                  <i class="fas fa-check"></i>
                  Onayla
                </button>
                <button class="button reject" onclick="cancelReservation('${reservation.id}')">
                  <i class="fas fa-times"></i>
                  Reddet
                </button>
              </div>
            </div>
          `;
          
          reservationsList.appendChild(card);
        });
      }

      function confirmReservation(reservationId) {
        if (confirm('Rezervasyonu onaylamak istediğinize emin misiniz?')) {
          const reservations = JSON.parse(localStorage.getItem('reservations')) || [];
          const reservationIndex = reservations.findIndex(r => r.id === reservationId);
          
          if (reservationIndex !== -1) {
            reservations[reservationIndex].status = 'confirmed';
            localStorage.setItem('reservations', JSON.stringify(reservations));
            loadReservations();
            showNotification('Rezervasyon onaylandı', 'success');
          }
        }
      }

      function cancelReservation(reservationId) {
        if (confirm('Rezervasyonu reddetmek istediğinize emin misiniz?')) {
          const reservations = JSON.parse(localStorage.getItem('reservations')) || [];
          const reservationIndex = reservations.findIndex(r => r.id === reservationId);
          
          if (reservationIndex !== -1) {
            reservations[reservationIndex].status = 'cancelled';
            localStorage.setItem('reservations', JSON.stringify(reservations));
            loadReservations();
            showNotification('Rezervasyon reddedildi', 'info');
          }
        }
      }

      function verifyReceipt(reservationId) {
        if (confirm('Dekontu onaylamak istediğinize emin misiniz?')) {
          const reservations = JSON.parse(localStorage.getItem('reservations')) || [];
          const reservationIndex = reservations.findIndex(r => r.id === reservationId);
          
          if (reservationIndex !== -1) {
            reservations[reservationIndex] = {
              ...reservations[reservationIndex],
              receiptStatus: 'verified',
              receiptVerifiedDate: new Date().toISOString()
            };
            
            localStorage.setItem('reservations', JSON.stringify(reservations));
            loadPendingReceipts();
            showNotification('Dekont onaylandı', 'success');
          }
        }
      }

      function rejectReceipt(reservationId) {
        if (confirm('Dekontu reddetmek istediğinize emin misiniz?')) {
          const reservations = JSON.parse(localStorage.getItem('reservations')) || [];
          const reservationIndex = reservations.findIndex(r => r.id === reservationId);
          
          if (reservationIndex !== -1) {
            reservations[reservationIndex] = {
              ...reservations[reservationIndex],
              receiptStatus: 'rejected',
              receiptRejectedDate: new Date().toISOString()
            };
            
            localStorage.setItem('reservations', JSON.stringify(reservations));
            loadPendingReceipts();
            showNotification('Dekont reddedildi', 'error');
          }
        }
      }

      function loadPendingReceipts() {
        const reservations = JSON.parse(localStorage.getItem('reservations')) || [];
        const fields = JSON.parse(localStorage.getItem('fields')) || [];
        const users = JSON.parse(localStorage.getItem('users')) || { player: [] };
        
        // Debug için konsola yazdır
        console.log('Tüm rezervasyonlar:', reservations);
        
        // Sadece bu saha sahibinin sahalarına ait rezervasyonları filtrele
        const adminFields = fields.filter(f => f.adminId === currentUser.id);
        const adminFieldIds = adminFields.map(f => f.id);
        const adminReservations = reservations.filter(r => adminFieldIds.includes(r.fieldId));
        
        // Debug için konsola yazdır
        console.log('Admin rezervasyonları:', adminReservations);
        
        // Dekont onayı bekleyen rezervasyonları filtrele
        const pendingReceipts = adminReservations.filter(r => 
          r.status === 'confirmed' && 
          r.receipt && 
          (!r.receiptStatus || r.receiptStatus === 'rejected')
        );
        
        // Debug için konsola yazdır
        console.log('Bekleyen dekontlar:', pendingReceipts);
        
        const pendingReceiptsList = document.getElementById('pendingReceiptsList');
        
        if (pendingReceipts.length === 0) {
          pendingReceiptsList.innerHTML = `
            <div class="no-reservations">
              <i class="fas fa-file-invoice"></i>
              <p>Dekont onayı bekleyen rezervasyon bulunmuyor.</p>
            </div>
          `;
          return;
        }
        
        pendingReceiptsList.innerHTML = '';
        
        pendingReceipts.forEach(reservation => {
          const field = fields.find(f => f.id === reservation.fieldId);
          const player = users.player.find(p => p.id === reservation.playerId);
          
          if (!field || !player) return;
          
          const card = document.createElement('div');
          card.className = 'reservation-card';
          card.innerHTML = `
            <div class="reservation-header">
              <div class="reservation-field">
                <i class="fas fa-futbol"></i>
                ${field.name}
              </div>
              <div class="reservation-status ${reservation.receiptStatus === 'rejected' ? 'status-cancelled' : 'status-pending'}">
                ${reservation.receiptStatus === 'rejected' ? 'Dekont Reddedildi' : 'Dekont İnceleniyor'}
              </div>
            </div>
            <div class="reservation-content">
              <div class="reservation-info">
                <div class="reservation-detail">
                  <i class="fas fa-user"></i>
                  <div>
                    <div>${player.name}</div>
                    <div style="font-size: 12px; color: #999;">${player.email}</div>
                  </div>
                </div>
                <div class="reservation-detail">
                  <i class="fas fa-calendar"></i>
                  <div>
                    <div class="reservation-date">${reservation.date}</div>
                    <div class="reservation-time">${reservation.time}</div>
                  </div>
                </div>
                <div class="reservation-detail">
                  <i class="fas fa-phone"></i>
                  <div class="reservation-phone">${player.phone}</div>
                </div>
                <div class="receipt-section">
                  <div class="receipt-status ${reservation.receiptStatus || 'pending'}">
                    <i class="fas ${reservation.receiptStatus === 'rejected' ? 'fa-times-circle' : 'fa-clock'}"></i>
                    ${reservation.receiptStatus === 'rejected' ? 'Dekont Reddedildi' : 'Dekont İnceleniyor'}
                  </div>
                  <div class="receipt-preview-container">
                    <img src="${reservation.receipt}" alt="Dekont" class="receipt-preview show" style="max-width: 100%; height: auto; margin: 10px 0;">
                  </div>
                  <div class="receipt-actions">
                    <button class="button verify" onclick="verifyReceipt('${reservation.id}')">
                      <i class="fas fa-check"></i>
                      Dekontu Onayla
                    </button>
                    <button class="button reject" onclick="rejectReceipt('${reservation.id}')">
                      <i class="fas fa-times"></i>
                      Dekontu Reddet
                    </button>
                  </div>
                </div>
              </div>
            </div>
          `;
          
          pendingReceiptsList.appendChild(card);
        });
      }

      // Sayfa yüklendiğinde sahaları ve rezervasyonları yükle
      document.addEventListener('DOMContentLoaded', function() {
      loadFields();
        loadReservations();
      });
    </script>
  </body>
</html> 